Enter<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ø³Ù„Ù… Ø§Ù„ØªØ¯Ø±Ø¬ - ØªÙŠØ³Øª</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">

  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
      --gold:#d4af37; --gold-light:#f4d03f; --dark:#0a0a0f;
      --card:#12121a; --muted:#9aa0a6; --transition:.15s cubic-bezier(.4,0,.2,1);
      --max:680px;
      --ok:#22c55e; --bad:#ef4444; --blue:#3b82f6;
    }
    html{background:var(--dark); color:#fff; text-rendering:optimizeLegibility; -webkit-font-smoothing:antialiased}
    body{font-family:"Tajawal",system-ui,sans-serif; min-height:100dvh; overflow-x:hidden}

    .gold-text{
      background:linear-gradient(135deg,var(--gold) 0%,var(--gold-light) 50%,var(--gold) 100%);
      background-size:200% auto;
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      animation:shimmer 3s linear infinite;
    }
    @keyframes shimmer{to{background-position:200% center}}

    .header{
      position:fixed; inset:0 0 auto 0; height:60px; z-index:1000;
      background:rgba(10,10,15,.95);
      backdrop-filter: blur(18px) saturate(160%);
      border-bottom:1px solid rgba(212,175,55,.12);
    }
    .header-inner{
      max-width:var(--max); margin:0 auto; height:100%;
      display:flex; align-items:center; justify-content:space-between;
      padding:0 16px;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .badge{
      width:40px;height:40px;border-radius:50%;
      background:linear-gradient(135deg,var(--gold),var(--gold-light));
      display:grid; place-items:center;
      box-shadow:0 0 20px rgba(212,175,55,.25);
      color:#0a0a0f; font-size:20px;
    }
    .icon-btn{
      width:38px;height:38px;border-radius:50%;
      background:rgba(212,175,55,.10);
      border:1px solid rgba(212,175,55,.20);
      color:var(--gold);
      display:grid; place-items:center;
      cursor:pointer;
      transition:transform var(--transition);
    }
    .icon-btn:active{transform:scale(.96)}

    .nav{
      position:fixed; top:60px; left:0; right:0; z-index:999;
      background:linear-gradient(180deg,rgba(10,10,15,.98),rgba(10,10,15,.88));
      border-bottom:1px solid rgba(212,175,55,.06);
      padding:10px 12px;
      overflow-x:auto; scrollbar-width:none;
    }
    .nav::-webkit-scrollbar{display:none}
    .nav-inner{
      max-width:var(--max);
      margin:0 auto;
      display:flex; gap:10px;
      min-width:max-content;
      padding:0 4px;
    }
    .nav-btn{
      flex:0 0 auto;
      background:rgba(212,175,55,.08);
      border:1px solid rgba(212,175,55,.15);
      color:#fff;
      padding:10px 16px;
      border-radius:12px;
      font-weight:900;
      font-size:13px;
      cursor:pointer;
      transition:all var(--transition);
      white-space:nowrap;
    }
    .nav-btn.active{
      background:linear-gradient(135deg,rgba(212,175,55,.26),rgba(212,175,55,.10));
      border-color:var(--gold);
      box-shadow:0 6px 22px rgba(212,175,55,.18);
      transform:translateY(-2px);
    }

    main{
      max-width:var(--max);
      margin:0 auto;
      padding:16px;
      padding-top:120px;
      padding-bottom:118px;
    }

    .grid{display:grid; gap:14px}
    .card{
      background:linear-gradient(145deg,rgba(18,18,26,.92),rgba(10,10,15,.96));
      border:1px solid rgba(212,175,55,.10);
      border-radius:22px;
      padding:18px;
      box-shadow:0 4px 26px rgba(0,0,0,.35);
      transition:transform var(--transition), box-shadow var(--transition), border-color var(--transition);
    }
    .card:hover{border-color:rgba(212,175,55,.22); box-shadow:0 10px 36px rgba(212,175,55,.10); transform:translateY(-2px)}
    .row{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .subtle{color:var(--muted); font-weight:800; font-size:12px}
    .title{font-size:22px; font-weight:1000}
    .wrap{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border-radius:999px;
      padding:8px 12px;
      font-weight:900;
      font-size:12px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.04);
      color:#e5e7eb;
    }
    .pill.gold{border-color:rgba(212,175,55,.25); background:rgba(212,175,55,.10); color:var(--gold)}
    .pill.blue{border-color:rgba(59,130,246,.25); background:rgba(59,130,246,.12); color:#93c5fd}
    .pill.ok{border-color:rgba(34,197,94,.25); background:rgba(34,197,94,.12); color:#86efac}
    .pill.bad{border-color:rgba(239,68,68,.25); background:rgba(239,68,68,.12); color:#fca5a5}

    .section{
      background:rgba(0,0,0,.22);
      border-radius:16px;
      padding:14px;
      margin-top:12px;
      border-right:3px solid var(--gold);
    }

    .goal{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.07);
      background:rgba(0,0,0,.22);
    }
    .goal h4{font-size:15px; font-weight:1000; line-height:1.6}
    .goal p{margin-top:6px; color:#cbd5e1; font-weight:700; font-size:12px; line-height:1.7}
    .goal-actions{display:flex; flex-direction:column; gap:8px; align-items:flex-end}
    .btn{
      border:none;
      cursor:pointer;
      border-radius:12px;
      padding:9px 12px;
      font-weight:1000;
      font-size:12px;
      transition:transform var(--transition), filter var(--transition), background var(--transition);
      color:#0a0a0f;
    }
    .btn:active{transform:scale(.97)}
    .btn.primary{background:linear-gradient(135deg,var(--gold),var(--gold-light))}
    .btn.ghost{
      background:rgba(255,255,255,.06);
      color:#e5e7eb;
      border:1px solid rgba(255,255,255,.10);
    }
    .btn.danger{
      background:rgba(239,68,68,.15);
      color:#fecaca;
      border:1px solid rgba(239,68,68,.25);
    }

    .medals{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .medal{
      display:inline-flex; align-items:center; gap:6px;
      background:rgba(255,215,0,.15);
      color:#ffd700;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:1000;
      border:1px solid rgba(255,215,0,.20);
    }

    .fab-wrap{
      position:fixed; left:18px; bottom:92px; z-index:1000;
      display:flex; flex-direction:column; gap:12px;
    }
    .fab{
      width:56px;height:56px;border-radius:50%;
      border:none; cursor:pointer;
      display:grid; place-items:center;
      font-size:22px;
      box-shadow:0 6px 24px rgba(0,0,0,.45);
      transition:transform var(--transition);
    }
    .fab:hover{transform:scale(1.06)}
    .fab:active{transform:scale(.96)}
    .fab.blue{background:linear-gradient(135deg,#3b82f6,#1d4ed8); color:#fff}
    .fab.gold{background:linear-gradient(135deg,var(--gold),var(--gold-light)); color:#0a0a0f}

    .bottom{
      position:fixed; inset:auto 0 0 0; z-index:999;
      background:rgba(10,10,15,.98);
      backdrop-filter: blur(18px);
      border-top:1px solid rgba(212,175,55,.12);
      padding:8px 0 calc(8px + env(safe-area-inset-bottom));
    }
    .bottom-inner{max-width:var(--max); margin:0 auto; display:flex}
    .nav-item{
      flex:1; background:none; border:none; color:#6b7280;
      display:flex; flex-direction:column; align-items:center; gap:4px;
      padding:8px 6px;
      font-weight:1000; font-size:11px; cursor:pointer;
      transition:color var(--transition), transform var(--transition);
    }
    .nav-item.active{color:var(--gold)}
    .nav-item:active{transform:scale(.96)}

    .toast{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:140px;
      background:rgba(0,0,0,.65);
      border:1px solid rgba(212,175,55,.18);
      padding:10px 14px;
      border-radius:999px;
      font-weight:900;
      font-size:13px;
      opacity:0; pointer-events:none;
      transition:opacity var(--transition);
      max-width:min(92vw,520px);
      text-align:center;
    }
    .toast.show{opacity:1}

    .hidden{display:none !important;}
    a{color:inherit}
  </style>
</head>

<body>
  <header class="header">
    <div class="header-inner">
      <div class="brand">
        <div class="badge" aria-hidden="true">ğŸªœ</div>
        <div>
          <div class="subtle">ØªÙŠØ³Øª ØªØ·Ø¨ÙŠÙ‚ ÙØ¹Ù„ÙŠ - ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©</div>
          <div class="gold-text" style="font-weight:1000;font-size:18px">Ø³Ù„Ù… Ø§Ù„ØªØ¯Ø±Ø¬</div>
        </div>
      </div>
      <button class="icon-btn" id="resetBtn" title="ØªØµÙÙŠØ± Ø§Ù„ØªÙŠØ³Øª" aria-label="ØªØµÙÙŠØ±">ğŸ§¹</button>
    </div>
  </header>

  <nav class="nav" aria-label="Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ">
    <div class="nav-inner">
      <button class="nav-btn active" data-view="home">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      <button class="nav-btn" data-view="ladder">ğŸªœ Ø§Ù„Ø³Ù„Ù…</button>
      <button class="nav-btn" data-view="stats">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
      <button class="nav-btn" data-view="dialogues">ğŸ’¬ Ø§Ù„Ø­ÙˆØ§Ø±Ø§Øª</button>
    </div>
  </nav>

  <main>
    <!-- HOME -->
    <section class="grid" id="view-home">
      <div class="card">
        <div class="row">
          <div>
            <div class="subtle">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</div>
            <div class="title gold-text">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ¬Ø±Ø¨Ø©</div>
          </div>
          <span class="pill gold" id="todayPill">Ø§Ù„ÙŠÙˆÙ…</span>
        </div>

        <div class="section">
          <div class="wrap">
            <span class="pill" id="streakPill">Ø³ØªØ±ÙŠÙƒ: 0</span>
            <span class="pill" id="donePill">Ù…Ù†Ø¬Ø²: 0</span>
            <span class="pill" id="medalsPill">Ù…ÙŠØ¯Ø§Ù„ÙŠØ§Øª: 0</span>
          </div>

          <div class="wrap" style="margin-top:12px">
            <button class="btn primary" id="goLadderBtn">Ø±ÙˆØ­ Ù„Ù„Ø³Ù„Ù…</button>
            <button class="btn ghost" id="quickDoneBtn">Ø¥Ù†Ø¬Ø§Ø² Ø³Ø±ÙŠØ¹ (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)</button>
          </div>

          <div class="subtle" style="margin-top:12px; line-height:1.7">
            ÙƒÙ„ Ø¥Ù†Ø¬Ø§Ø² Ø¨ÙŠØªØ³Ø¬Ù„ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§. Ø§Ù‚ÙÙ„ ÙˆØ§ÙØªØ­ Ù‡ØªÙ„Ø§Ù‚ÙŠÙ‡ Ù…ÙˆØ¬ÙˆØ¯.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="row">
          <div>
            <div class="subtle">Ù…Ù„Ø§Ø­Ø¸Ø©</div>
            <div class="title">Ø¯Ù‡ ØªÙŠØ³Øª</div>
          </div>
          <span class="pill blue">SPA</span>
        </div>
        <div class="section">
          <div class="subtle" style="line-height:1.8">
            Ù„Ùˆ Ø¹Ø§ÙŠØ² Ø¨Ø¹Ø¯ Ø§Ù„ØªÙŠØ³Øª Ø£Ø¹Ù…Ù„Ù‡ÙˆÙ„Ùƒ â€œØ¥Ø¶Ø§ÙØ© Ø£Ù‡Ø¯Ø§Ù / ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªÙˆÙŠØ§Øª / ØªÙ†Ø¨ÙŠÙ‡Ø§Øªâ€ØŒ Ù‚ÙˆÙ„Ù‘ÙŠ.
          </div>
        </div>
      </div>
    </section>

    <!-- LADDER -->
    <section class="grid hidden" id="view-ladder">
      <div class="card">
        <div class="row">
          <div>
            <div class="subtle">Ø§Ù„Ù‚Ø³Ù…</div>
            <div class="title gold-text">Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</div>
          </div>
          <span class="pill gold" id="levelProgressPill">ØªÙ‚Ø¯Ù…: 0/3</span>
        </div>

        <div class="section" id="levelsContainer"></div>
      </div>
    </section>

    <!-- STATS -->
    <section class="grid hidden" id="view-stats">
      <div class="card">
        <div class="row">
          <div>
            <div class="subtle">Ø§Ù„Ù‚Ø³Ù…</div>
            <div class="title gold-text">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
          </div>
          <span class="pill">Local</span>
        </div>

        <div class="section">
          <div class="wrap" id="statsWrap"></div>
        </div>

        <div class="section">
          <div class="row">
            <span class="pill blue">Ø¢Ø®Ø± Ø¥Ù†Ø¬Ø§Ø²</span>
            <span class="pill" id="lastDonePill">â€”</span>
          </div>
        </div>
      </div>
    </section>

    <!-- DIALOGUES -->
    <section class="grid hidden" id="view-dialogues">
      <div class="card">
        <div class="row">
          <div>
            <div class="subtle">Ø§Ù„Ù‚Ø³Ù…</div>
            <div class="title gold-text">Ø­ÙˆØ§Ø±Ø§Øª Ù…ØªØ®ÙŠÙ„Ø©</div>
          </div>
          <span class="pill">ğŸ’¬</span>
        </div>

        <div class="section">
          <div class="goal">
            <div>
              <h4>Ø£Ù†Ø§ Ù‚ÙˆÙŠ ÙˆÙ…Ø´ Ù…Ø­ØªØ§Ø¬ Ø­Ø¯</h4>
              <p>Ø§Ù„Ù…ØªØ­Ø¯Ø«: Ø§Ù„Ù†ÙØ³</p>
            </div>
            <div class="goal-actions">
              <span class="pill bad">Ø§Ù„Ù†ÙØ³</span>
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="goal">
            <div>
              <h4>Ù„Ø§! Ù…Ù† Ù‚Ø§Ù„ Ø£Ù†Ø§ Ø¨Ø§Ù„Ø§Ø³ØªØºÙ†Ø§Ø¡ ÙƒØ°Ù‘Ø¨</h4>
              <p>Ø§Ù„Ù…ØªØ­Ø¯Ø«: Ø§Ù„Ù‚Ù„Ø¨</p>
            </div>
            <div class="goal-actions">
              <span class="pill ok">Ø§Ù„Ù‚Ù„Ø¨</span>
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="goal">
            <div>
              <h4>Ø·ÙŠØ¨ Ø£Ø¹Ù…Ù„ Ø¥ÙŠÙ‡ØŸ</h4>
              <p>Ø±Ø¯ Ø¹Ù…Ù„ÙŠ: Ø§Ø¨Ø¯Ø£ Ø¨Ø¯Ø±Ø¬Ø© ÙˆØ§Ø­Ø¯Ø© Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡</p>
            </div>
            <div class="goal-actions">
              <button class="btn primary" id="goHomeBtn">Ø§Ø¨Ø¯Ø£</button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div class="fab-wrap" aria-label="Ø£Ø²Ø±Ø§Ø± Ø³Ø±ÙŠØ¹Ø©">
    <button class="fab blue" id="fabStats" title="Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª">ğŸ“Š</button>
    <button class="fab gold" id="fabTop" title="Ù„Ù„Ø£Ø¹Ù„Ù‰">â¬†ï¸</button>
  </div>

  <nav class="bottom" aria-label="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ©">
    <div class="bottom-inner">
      <button class="nav-item active" data-view="home">
        <div style="font-size:22px" aria-hidden="true">ğŸ </div><div>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
      </button>
      <button class="nav-item" data-view="ladder">
        <div style="font-size:22px" aria-hidden="true">ğŸªœ</div><div>Ø§Ù„Ø³Ù„Ù…</div>
      </button>
      <button class="nav-item" data-view="stats">
        <div style="font-size:22px" aria-hidden="true">ğŸ“Š</div><div>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
      </button>
      <button class="nav-item" data-view="dialogues">
        <div style="font-size:22px" aria-hidden="true">ğŸ’¬</div><div>Ø­ÙˆØ§Ø±Ø§Øª</div>
      </button>
    </div>
  </nav>

  <div class="toast" id="toast"></div>

  <script>
    // -------- state & storage ----------
    const STORAGE_KEY = "ladder_app_v1";
    const todayISO = () => new Date().toISOString().slice(0,10);

    const defaultState = () => ({
      createdAt: Date.now(),
      lastDoneDate: null,
      streak: 0,
      totalDone: 0,
      medals: 0,
      doneByGoalId: {}, // {goalId: true}
      doneLog: [] // [{date, goalId}]
    });

    const LEVELS = [
      {
        id:"lvl1", name:"Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1", icon:"ğŸ¥‡",
        goals:[
          { id:"g1", title:"Ø§Ø­ÙØ¸ Ø¯Ø¹Ø§Ø¡ ÙŠØ§ Ø­ÙŠ ÙŠØ§ Ù‚ÙŠÙˆÙ…", reward:1 }
        ]
      },
      {
        id:"lvl2", name:"Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 2", icon:"ğŸ¥ˆ",
        goals:[
          { id:"g2", title:"ØµÙ… ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯ ÙÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹", reward:2 }
        ]
      },
      {
        id:"lvl3", name:"Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 3", icon:"ğŸ¥‰",
        goals:[
          { id:"g3", title:"Ù‚Ù… Ø§Ù„Ù„ÙŠÙ„ 3 Ù…Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹", reward:3 }
        ]
      }
    ];

    const loadState = () => {
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultState();
        const s = JSON.parse(raw);
        return { ...defaultState(), ...s };
      }catch(e){
        return defaultState();
      }
    };

    const saveState = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(state));

    let state = loadState();

    // -------- ui helpers ----------
    const $$ = (s, root=document) => Array.from(root.querySelectorAll(s));
    const toast = document.getElementById("toast");
    const showToast = (msg) => {
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>toast.classList.remove("show"), 1400);
    };

    const setActiveNav = (view) => {

      $$(".nav-btn").forEach(b=>b.classList.toggle("active", b.dataset.view===view));

      $$(".bottom .nav-item").forEach(b=>b.classList.toggle("active", b.dataset.view===view));
    };

    const showView = (view) => {
      const views = ["home","ladder","stats","dialogues"];
      views.forEach(v=>{
        document.getElementById("view-"+v).classList.toggle("hidden", v!==view);
      });
      setActiveNav(view);
      window.scrollTo({top:0, behavior:"smooth"});
    };

    // -------- app logic ----------
    const calcLevelProgress = () => {
      const doneGoals = Object.keys(state.doneByGoalId).length;
      const totalGoals = LEVELS.reduce((a,l)=>a+l.goals.length,0);
      return { doneGoals, totalGoals };
    };

    const updateStreak = () => {
      const t = todayISO();
      if(state.lastDoneDate === t) return; // already counted today
      if(!state.lastDoneDate){
        state.streak = 1;
      } else {
        const last = new Date(state.lastDoneDate);
        const now = new Date(t);
        const diffDays = Math.round((now - last) / (1000*60*60*24));
        if(diffDays === 1) state.streak += 1;
        else state.streak = 1;
      }
      state.lastDoneDate = t;
    };

    const markDone = (goalId, reward=1) => {
      if(state.doneByGoalId[goalId]){
        showToast("Ù…ØªØ³Ø¬Ù„ Ù‚Ø¨Ù„ ÙƒØ¯Ù‡");
        return;
      }
      state.doneByGoalId[goalId] = true;
      state.totalDone += 1;
      state.medals += reward;
      state.doneLog.unshift({ date: todayISO(), goalId });
      updateStreak();
      saveState();
      renderAll();
      showToast("ØªÙ…Ø§Ù…! Ø§ØªØ³Ø¬Ù„ âœ…");
      if(navigator.vibrate) navigator.vibrate(8);
    };

    const resetAll = () => {
      state = defaultState();
      saveState();
      renderAll();
      showToast("Ø§ØªØµÙÙ‘Ø± Ø§Ù„ØªÙŠØ³Øª");
    };

    // -------- render ----------
    const todayPill = document.getElementById("todayPill");
    const streakPill = document.getElementById("streakPill");
    const donePill = document.getElementById("donePill");
    const medalsPill = document.getElementById("medalsPill");
    const levelProgressPill = document.getElementById("levelProgressPill");
    const lastDonePill = document.getElementById("lastDonePill");
    const statsWrap = document.getElementById("statsWrap");
    const levelsContainer = document.getElementById("levelsContainer");

    const renderHome = () => {
      todayPill.textContent = "Ø§Ù„ÙŠÙˆÙ…: " + todayISO();
      streakPill.textContent = "Ø³ØªØ±ÙŠÙƒ: " + (state.streak || 0);
      donePill.textContent = "Ù…Ù†Ø¬Ø²: " + (state.totalDone || 0);
      medalsPill.textContent = "Ù…ÙŠØ¯Ø§Ù„ÙŠØ§Øª: " + (state.medals || 0);
    };

    const renderLevels = () => {
      const {doneGoals,totalGoals} = calcLevelProgress();
      levelProgressPill.textContent = `ØªÙ‚Ø¯Ù…: ${doneGoals}/${totalGoals}`;

      levelsContainer.innerHTML = "";
      LEVELS.forEach(level=>{
        const levelDone = level.goals.every(g => !!state.doneByGoalId[g.id]);
        const levelEl = document.createElement("div");
        levelEl.className = "goal";
        levelEl.style.marginBottom = "10px";
        levelEl.innerHTML = `
          <div style="min-width:0">
            <h4 style="display:flex;gap:10px;align-items:center">
              <span aria-hidden="true">${level.icon}</span>
              <span>${level.name}</span>
              ${levelDone ? `<span class="pill ok">Ù…ÙƒØªÙ…Ù„</span>` : ``}
            </h4>
            <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù: ${level.goals.length}</p>
          </div>
          <div class="goal-actions">
            <span class="pill gold">Ù…ÙƒØ§ÙØ£Ø©</span>
          </div>
        `;
        levelsContainer.appendChild(levelEl);

        level.goals.forEach(goal=>{
          const done = !!state.doneByGoalId[goal.id];
          const g = document.createElement("div");
          g.className = "goal";
          g.style.marginBottom = "10px";
          g.innerHTML = `
            <div style="min-width:0">
              <h4>${goal.title}</h4>
              <p>${done ? "Ø§ØªØ¹Ù…Ù„ âœ…" : "Ù„Ø³Ù‡"}</p>
              <div class="medals">
                <span class="medal">ğŸ… +${goal.reward} Ù…ÙŠØ¯Ø§Ù„ÙŠØ©</span>
              </div>
            </div>
            <div class="goal-actions">
              ${
                done
                ? `<span class="pill ok">ØªÙ…</span>`
                : `<button class="btn primary" data-done="${goal.id}" data-reward="${goal.reward}">ØªÙ…</button>`
              }
            </div>
          `;
          levelsContainer.appendChild(g);
        });

        const hr = document.createElement("div");
        hr.style.height = "8px";
        levelsContainer.appendChild(hr);
      });

      // bind done buttons

      $$("button[data-done]", levelsContainer).forEach(btn=>{
        btn.addEventListener("click", ()=>{
          markDone(btn.dataset.done, Number(btn.dataset.reward||1));
        });
      });
    };

    const renderStats = () => {
      statsWrap.innerHTML = "";

      const {doneGoals,totalGoals} = calcLevelProgress();
      const items = [
        ["ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…", todayISO(), "blue"],
        ["Ø³ØªØ±ÙŠÙƒ", String(state.streak||0), "gold"],
        ["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª", String(state.totalDone||0), "gold"],
        ["Ù…ÙŠØ¯Ø§Ù„ÙŠØ§Øª", String(state.medals||0), "gold"],
        ["Ø£Ù‡Ø¯Ø§Ù Ù…ÙƒØªÙ…Ù„Ø©", `${doneGoals}/${totalGoals}`, "blue"],
        ["Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª", String(state.doneLog.length), "blue"]
      ];

      items.forEach(([k,v,cls])=>{
        const el = document.createElement("span");
        el.className = "pill " + (cls||"");
        el.textContent = `${k}: ${v}`;
        statsWrap.appendChild(el);
      });

      if(state.doneLog[0]){
        lastDonePill.textContent = `${state.doneLog[0].goalId} - ${state.doneLog[0].date}`;
      } else {
        lastDonePill.textContent = "â€”";
      }
    };

    const renderAll = () => {
      renderHome();
      renderLevels();
      renderStats();
    };

    // -------- events ----------

    $$(".nav-btn").forEach(b=>{
      b.addEventListener("click", ()=> showView(b.dataset.view), {passive:true});
    });

    $$(".bottom .nav-item").forEach(b=>{
      b.addEventListener("click", ()=> showView(b.dataset.view), {passive:true});
    });

    document.getElementById("fabTop").addEventListener("click", ()=>{
      window.scrollTo({top:0, behavior:"smooth"});
    }, {passive:true});

    document.getElementById("fabStats").addEventListener("click", ()=>{
      showView("stats");
    }, {passive:true});

    document.getElementById("goLadderBtn").addEventListener("click", ()=> showView("ladder"));
    document.getElementById("goHomeBtn").addEventListener("click", ()=> showView("home"));

    document.getElementById("quickDoneBtn").addEventListener("click", ()=>{
      // for test: mark next not-done goal
      const allGoals = LEVELS.flatMap(l=>l.goals);
      const next = allGoals.find(g => !state.doneByGoalId[g.id]);
      if(!next) return showToast("ÙƒÙ„ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ù…ÙƒØªÙ…Ù„Ø©");
      markDone(next.id, next.reward);
    });

    document.getElementById("resetBtn").addEventListener("click", ()=>{
      const ok = confirm("Ù…ØªØ£ÙƒØ¯ ØªØµÙÙ‘Ø± Ø§Ù„ØªÙŠØ³ØªØŸ");
      if(ok) resetAll();
    });

    // initial
    renderAll();
    showView("home");
  </script>
</body>
</html>
